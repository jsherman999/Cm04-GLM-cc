<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CM-04 Scanner - Linux Host Access Control Analysis</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>CM-04 Scanner</h1>
            <p>Linux Host Filesystem Access Control Analysis</p>
        </header>

        <main class="main-content">
            <!-- Upload Section -->
            <section class="upload-section" id="uploadSection">
                <h2>Submit Scan Request</h2>

                <div class="upload-tabs">
                    <button class="tab-button active" data-tab="file">File Upload</button>
                    <button class="tab-button" data-tab="manual">Manual Entry</button>
                </div>

                <!-- File Upload Tab -->
                <div class="tab-content active" id="fileTab">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-content">
                            <svg class="upload-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7,10 12,15 17,10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            <h3>Drop files here or click to browse</h3>
                            <p>Supported formats: CSV, TXT, JSON</p>
                            <input type="file" id="fileInput" accept=".csv,.txt,.json" multiple hidden>
                            <button class="browse-button">Browse Files</button>
                        </div>
                    </div>
                    <div class="file-preview" id="filePreview" style="display: none;">
                        <h4>Selected Files:</h4>
                        <ul id="fileList"></ul>
                        <div class="job-settings">
                            <label for="jobName">Job Name (optional):</label>
                            <input type="text" id="jobName" placeholder="Enter job name">
                        </div>
                        <button class="scan-button" id="scanFromFileButton">Start Scan</button>
                    </div>
                </div>

                <!-- Manual Entry Tab -->
                <div class="tab-content" id="manualTab">
                    <div class="manual-entry">
                        <div class="form-group">
                            <label for="jobNameManual">Job Name (optional):</label>
                            <input type="text" id="jobNameManual" placeholder="Enter job name">
                        </div>
                        <div class="hosts-input">
                            <label>Hosts and Code Paths:</label>
                            <div class="host-entries" id="hostEntries">
                                <div class="host-entry">
                                    <input type="text" placeholder="Hostname" class="hostname-input">
                                    <input type="text" placeholder="Code paths (comma-separated)" class="paths-input">
                                    <button class="remove-button" onclick="removeHostEntry(this)">Ã—</button>
                                </div>
                            </div>
                            <button class="add-button" onclick="addHostEntry()">+ Add Host</button>
                        </div>
                        <button class="scan-button" id="scanManualButton">Start Scan</button>
                    </div>
                </div>
            </section>

            <!-- Progress Section -->
            <section class="progress-section" id="progressSection" style="display: none;">
                <h2>Scan Progress</h2>
                <div class="progress-container">
                    <div class="progress-info">
                        <div class="job-info">
                            <span class="job-id" id="jobId"></span>
                            <span class="job-status" id="jobStatus"></span>
                        </div>
                        <div class="progress-stats">
                            <span id="progressText">0 / 0 hosts completed</span>
                            <span id="progressPercent">0%</span>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="current-host" id="currentHost">Starting scan...</div>
                </div>
            </section>

            <!-- Results Section -->
            <section class="results-section" id="resultsSection" style="display: none;">
                <h2>Scan Results</h2>
                <div class="results-summary">
                    <div class="summary-cards">
                        <div class="summary-card">
                            <h3>Total Hosts</h3>
                            <span id="totalHosts">0</span>
                        </div>
                        <div class="summary-card">
                            <h3>Completed</h3>
                            <span id="completedHosts">0</span>
                        </div>
                        <div class="summary-card">
                            <h3>Failed</h3>
                            <span id="failedHosts">0</span>
                        </div>
                        <div class="summary-card">
                            <h3>Users with Access</h3>
                            <span id="totalUsers">0</span>
                        </div>
                    </div>
                </div>

                <div class="results-actions">
                    <button class="download-button" onclick="downloadReport('csv')">Download CSV</button>
                    <button class="download-button" onclick="downloadReport('json')">Download JSON</button>
                    <button class="download-button" onclick="downloadReport('html')">View HTML Report</button>
                    <button class="new-scan-button" onclick="newScan()">New Scan</button>
                </div>

                <div class="results-table-container">
                    <table class="results-table" id="resultsTable">
                        <thead>
                            <tr>
                                <th>Hostname</th>
                                <th>Code Path</th>
                                <th>User ID</th>
                                <th>Login Method</th>
                                <th>Privilege Type</th>
                                <th>Privilege Source</th>
                            </tr>
                        </thead>
                        <tbody id="resultsTableBody">
                            <!-- Results will be populated here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Debug Section -->
            <section class="debug-section" id="debugSection">
                <h2>Debug Console</h2>
                <div class="debug-controls">
                    <button class="debug-button" onclick="clearDebugLogs()">Clear Logs</button>
                    <button class="debug-button" onclick="toggleDebugConsole()">Toggle Console</button>
                </div>
                <div class="debug-console" id="debugConsole">
                    <div id="debugLogs"></div>
                </div>
            </section>
        </main>

        <footer class="footer">
            <p>CM-04 Scanner v1.0.0 - Configuration Management Compliance Tool</p>
        </footer>
    </div>

    <!-- Loading Modal -->
    <div class="modal" id="loadingModal">
        <div class="modal-content">
            <div class="loading-spinner"></div>
            <p id="loadingMessage">Processing...</p>
        </div>
    </div>

    <!-- Error Modal -->
    <div class="modal" id="errorModal">
        <div class="modal-content">
            <h3>Error</h3>
            <p id="errorMessage"></p>
            <button class="modal-button" onclick="closeErrorModal()">Close</button>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>